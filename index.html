<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéÉ Somnia Halloween Game üéÉ</title>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: radial-gradient(circle at top, #0a0a0a, #111, #000);
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 40px;
      overflow-x: hidden;
    }

    h1 {
      color: #ff6600;
      text-shadow: 0 0 15px #ff6600, 0 0 30px #ff3300;
      font-size: 2.7em;
    }

    #wallet {
      margin: 10px 0;
      color: #00ffff;
      font-weight: bold;
    }

    button {
      background: linear-gradient(90deg, #ff6600, #ff00ff);
      border: none;
      padding: 12px 25px;
      border-radius: 30px;
      cursor: pointer;
      color: #fff;
      font-size: 1em;
      margin: 10px;
      transition: all 0.3s;
      font-weight: bold;
      text-transform: uppercase;
    }

    button:hover {
      transform: scale(1.08);
      box-shadow: 0 0 20px #ff6600;
    }

    #leaderboard {
      margin-top: 40px;
      padding: 20px;
      border: 2px solid #ff6600;
      border-radius: 20px;
      background: rgba(255, 255, 255, 0.05);
      box-shadow: 0 0 30px #ff660088;
    }

    #leaderboard h3 {
      color: #ff00ff;
      text-shadow: 0 0 15px #ff00ff;
    }

    #leaderboard p {
      font-size: 1.1em;
      color: #fff;
      margin: 5px 0;
      text-shadow: 0 0 5px #ff6600;
    }

    #pumpkin {
      margin: 30px auto;
      width: 160px;
      height: 160px;
      background: url('https://i.ibb.co/d7DhWQv/pumpkin.png') no-repeat center;
      background-size: contain;
      cursor: pointer;
      transition: transform 0.1s;
    }

    #pumpkin:active {
      transform: scale(0.9);
    }

    #score {
      font-size: 1.3em;
      color: #00ff99;
      margin-top: 10px;
      text-shadow: 0 0 8px #00ff99;
    }
  </style>
</head>
<body>
  <h1>üéÉ Somnia Halloween Game üéÉ</h1>
  <p>Connect wallet, click the pumpkin, and climb the leaderboard!</p>

  <div id="wallet">Wallet not connected</div>
  <button onclick="connectWallet()">Connect Wallet</button>

  <div id="pumpkin" onclick="clickPumpkin()"></div>
  <div id="score">Your Score: 0</div>

  <button onclick="submitScore()">Submit Score</button>
  <button onclick="loadLeaderboard()">Load Leaderboard</button>

  <div id="leaderboard">
    <h3>üèÜ Leaderboard üèÜ</h3>
    <p>No scores yet...</p>
  </div>

  <!-- Ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>

  <script>
    // === NETWORK CONFIG ===
    const CHAIN_ID_DEC = 50312;
    const CHAIN_ID_HEX = "0xC508";
    const CONTRACT_ADDRESS = "0x6454Bb18d3161897905Ff9c662d74df06821C14F"; // ganti setelah deploy
    const RPC_URL = "https://dream-rpc.somnia.network/";

    // === CONTRACT ABI (contoh leaderboard sederhana) ===
    const CONTRACT_ABI = [
      {
        "inputs": [
          {"internalType": "string","name": "_name","type": "string"},
          {"internalType": "uint256","name": "_score","type": "uint256"}
        ],
        "name": "addScore",
        "outputs": [],
        "stateMutability": "nonpayable",
        "type": "function"
      },
      {
        "inputs": [],
        "name": "getTopPlayers",
        "outputs": [
          {
            "components": [
              {"internalType": "string","name": "name","type": "string"},
              {"internalType": "uint256","name": "score","type": "uint256"}
            ],
            "internalType": "struct Player[]",
            "name": "",
            "type": "tuple[]"
          }
        ],
        "stateMutability": "view",
        "type": "function"
      }
    ];

    let provider, signer, contract;
    let currentScore = 0;

    async function connectWallet() {
      if (typeof window.ethereum !== "undefined") {
        try {
          const chainId = await ethereum.request({ method: "eth_chainId" });

          // Jika bukan Somnia Testnet, ubah jaringan otomatis
          if (chainId !== CHAIN_ID_HEX) {
            await ethereum.request({
              method: "wallet_addEthereumChain",
              params: [{
                chainId: CHAIN_ID_HEX,
                chainName: "Somnia Testnet",
                nativeCurrency: {
                  name: "Somnia Test Token",
                  symbol: "STT",
                  decimals: 18
                },
                rpcUrls: [RPC_URL],
                blockExplorerUrls: ["https://shannon-explorer.somnia.network/"]
              }]
            });
          }

          await ethereum.request({ method: "eth_requestAccounts" });
          provider = new ethers.providers.Web3Provider(window.ethereum);
          signer = provider.getSigner();
          contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);

          const walletAddress = await signer.getAddress();
          document.getElementById("wallet").innerText = `Connected: ${walletAddress}`;
          alert("‚úÖ Wallet connected to Somnia Testnet!");
        } catch (err) {
          console.error(err);
          alert("‚ùå Failed to connect wallet.");
        }
      } else {
        alert("Please install MetaMask first.");
      }
    }

    function clickPumpkin() {
      currentScore += Math.floor(Math.random() * 10) + 1;
      document.getElementById("score").innerText = `Your Score: ${currentScore}`;
    }

    async function submitScore() {
      if (!contract) return alert("Please connect your wallet first.");
      const name = prompt("Enter your player name:");
      if (!name) return;

      try {
        const tx = await contract.addScore(name, currentScore);
        await tx.wait();
        alert(`üéÉ Score submitted! ${name}: ${currentScore}`);
        currentScore = 0;
        document.getElementById("score").innerText = `Your Score: 0`;
        loadLeaderboard();
      } catch (err) {
        console.error(err);
        alert("Error submitting score.");
      }
    }

    async function loadLeaderboard() {
      if (!contract) return alert("Please connect your wallet first.");
      try {
        const players = await contract.getTopPlayers();
        const board = document.getElementById("leaderboard");
        board.innerHTML = "<h3>üèÜ Leaderboard üèÜ</h3>";

        players.forEach((p, i) => {
          board.innerHTML += `<p>${i + 1}. ${p.name} ‚Äî ${p.score}</p>`;
        });
      } catch (err) {
        console.error(err);
      }
    }
  </script>
</body>
</html>
